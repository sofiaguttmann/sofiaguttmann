---
title: "Data Wrangling"
author: "Sofia"
format: pdf
editor: visual
---

```{r}
#| label: load-packages
#| warning: false

# load packages
library(tidyverse)
library(kableExtra)
library(robotstxt) 
library(rvest) 
library(purrr) 
library(readr)
library(tidyr)
library(sf) #for reading shape files

# set code chunk defaults
knitr::opts_chunk$set(tidy = F, # display code as typed
                      size = "small", # slightly smaller code font
                      message = FALSE,
                      warning = FALSE,
                      comment = "\t") 

# set black & white default plot theme
theme_set(theme_classic()) 

# improve digit and NA display 
options(scipen = 1, knitr.kable.NA = '')
```

# Data Wrangling and Cleaning

## Data Source 1: Kaggle- Fuel Data

```{r}
#| label: load-exported-csv
#| warning: false

# Read csv file obtained from Database
fuel <- read.csv("fuel.csv")


```

## Data Source 2: Wikipedia

Date accessed: 3/11/2024

```{r}


# Subset the dataset to include only the specified variables
Fuel_clean <- fuel[, c("year", "engine_cylinders", "fuel_type", "city_mpg_ft1", "tailpipe_co2_in_grams_mile_ft1")]

# View the structure of the cleaned dataset
str(Fuel_clean)



```

## Hclust

```{r}
# Select only the specified columns
Fuel_hclust <- Fuel_clean[, c("year", "engine_cylinders", "city_mpg_ft1", "tailpipe_co2_in_grams_mile_ft1")]

# View the structure of the cleaned dataset
str(Fuel_hclust)

```

```{r}
# Sample a subset of rows from your dataset
sampled_data <- Fuel_hclust[sample(nrow(Fuel_hclust), 1000), ]

# Scale the sampled data
scaled_data <- scale(sampled_data)

# Perform hierarchical clustering on the scaled data
hclust_result <- hclust(dist(scaled_data), method = "complete")

# Cut the dendrogram to obtain clusters
num_clusters <- 3  # Adjust the number of clusters as needed
cluster_assignment <- cutree(hclust_result, k = num_clusters)

# View cluster assignments
print(cluster_assignment)

# Perform hierarchical clustering with complete linkage
hclust_result <- hclust(dist(scaled_data), method = "complete")

# View cluster assignments
cluster_assignments <- cutree(hclust_result, k = 3)  # Adjust k as needed
print(cluster_assignments)

```

```{r}
library(ggplot2)

# Add cluster assignments to the sampled data
sampled_data$cluster <- factor(cluster_assignments)

# Plot the data points with cluster assignments
ggplot(sampled_data, aes(x = city_mpg_ft1, y = tailpipe_co2_in_grams_mile_ft1, color = cluster)) +
  geom_point() +
  labs(title = "Clustering Visualization", x = "City MPG", y = "Tailpipe CO2 (g/mile)")


```

```{r}
# Plot the dendrogram
plot(hclust_result)
suppressPackageStartupMessages(library(dendextend))
avg_dend_obj <- as.dendrogram(hclust_result)
avg_col_dend <- color_branches(avg_dend_obj, h = 3)
plot(avg_col_dend)
```

### 
